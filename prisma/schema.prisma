// ✅ Prisma schema — ثابت وملائم للكود الحالي

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Company {
  id               String     @id @default(cuid())
  name             String
  email            String?    @unique
  passwordHash     String?
  systemPrompt     String?
  botName          String     @default("Assistant")
  themePrimary     String     @default("#4f46e5") // قابل للتخصيص من الداشبورد
  logoUrl          String?
  suggested        Json?
  plan             String     @default("free")
  defaultLang      String     @default("ar")
  isPaused         Boolean    @default(false)
  dailyLimit       Int        @default(500)
  monthlyLimit     Int        @default(5000)
  watermarkEnabled Boolean    @default(false)
  createdAt        DateTime   @default(now())

  usages           Usage[]
  docs             Document[]
  otps             Otp[]
}

model Usage {
  id         String   @id @default(cuid())
  companyId  String
  company    Company  @relation(fields: [companyId], references: [id])

  // ✅ هذا الحقل هو اللي بنعد عليه شهريًّا
  createdAt  DateTime @default(now())

  @@index([companyId, createdAt])
}

model Document {
  id         String   @id @default(cuid())
  companyId  String
  company    Company  @relation(fields: [companyId], references: [id])

  title      String
  url        String?     // لو تخزين خارجي
  content    String?     // لو تخزين داخل DB (نصي)
  createdAt  DateTime @default(now())

  @@index([companyId, createdAt])
}

model Otp {
  id         String   @id @default(cuid())
  email      String
  code       String
  expiresAt  DateTime

  companyId  String?
  company    Company? @relation(fields: [companyId], references: [id])

  createdAt  DateTime @default(now())

  @@index([email, expiresAt])
}
